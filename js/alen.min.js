var EFaction={UNIVERSAL:1,SAKURA:2,EAGLE:4,ROYAL:8,IRONBLOOD:16,EASTERN_RAD:32,NORTH_UNION:64,IRIS:128,VICHYA:256,BILIBILI:512,NEPTUNIA:1024,UNKNOWN1:65536,SIREN:131072,props:{1:{name:"Universal",value:1,code:"UNIV"},2:{name:"Sakura Empire",value:2,code:"IJN"},4:{name:"Eagle Union",value:4,code:"USS"},8:{name:"Royal Navy",value:8,code:"HMS"},16:{name:"Ironblood",value:16,code:"KMS"},32:{name:"Eastern Radiance",value:32,code:"ROC"},64:{name:"North Union",value:64,code:"SN"},128:{name:"Iris Libre",value:128,code:"FFNF"},256:{name:"Vichya Dominion",value:256,code:"MNF"},512:{name:"Bilibili",value:512,code:"BIL"},1024:{name:"Neptunia",value:1024,code:"HDN"},65536:{name:"Unknown1",value:65536,code:"UNKN1"},131072:{name:"Sirens",value:131072,code:"SIREN"}}},EClass={CARRIER:1,LIGHT_CARRIER:2,BATTLESHIP:4,BATTLECRUISER:8,AVIATION_BATTLESHIP:16,MONITOR:32,REPAIR_SHIP:64,DESTROYER:128,LIGHT_CRUISER:256,HEAVY_CRUISER:512,SUBMARINE:1024,UNKNOWN1:2048,UNKNOWN2:4096,UNKNOWN3:8192,UNKNOWN4:16384,SUICIDE_BOAT:32768,BACKLINE:127,FRONTLINE:896,CARRIER_CLASS:19,props:{1:{name:"Aircraft Carrier",value:1,code:"CV"},2:{name:"Light Aircraft Carrier",value:2,code:"CVL"},4:{name:"Battleship",value:4,code:"BB"},8:{name:"Battlecruiser",value:8,code:"BC"},16:{name:"Aviation Battleship",value:16,code:"BBV"},32:{name:"Monitor",value:32,code:""},64:{name:"Repair Ship",value:64,code:"AR"},128:{name:"Destroyer",value:128,code:"DD"},256:{name:"Light Cruiser",value:256,code:"CL"},512:{name:"Heavy Cruiser",value:512,code:"CA"},1024:{name:"Submarine",value:1024,code:"SS"},2048:{name:"Unknown1",value:2048,code:"UNK1"},4096:{name:"Unknown2",value:4096,code:"UNK2"},8192:{name:"Unknown3",value:8192,code:"UNK3"},16384:{name:"Unknown4",value:16384,code:"UNK4"},32768:{name:"Suicide Boat",value:32768,code:"SB"},127:{name:"Backline",value:127,code:"Back"},896:{name:"Frontline",value:896,code:"Front"},19:{name:"Carrier Class",value:19,code:"Carrier"}}},ERarity={NORMAL:1,RARE:2,ELITE:4,SUPER_RARE:8,ULTRA_RARE:16,PRIORITY:32,props:{1:{name:"Normal",value:1,code:"N"},2:{name:"Rare",value:2,code:"R"},4:{name:"Elite",value:4,code:"SR"},8:{name:"Super Rare",value:8,code:"SR"},16:{name:"Ultra Rare",value:16,code:"UR"},32:{name:"Priority",value:32,code:"PR"}}},EGunType={DD_GUN:1,CL_GUN:2,CA_GUN:4,BB_GUN:8,TORP:16,SUB_TORP:32,FIGHTER:64,DIVE_BOMBER:128,TORP_BOMBER:256,ANTIAIR_GUN:512,AUX_EQ:1024,ASW_EQ:2048,SPECIAL:4096,DEUTS:8192,ASW_PLANES:16384,AIRCRAFT:448,props:{1:{name:"Destroyer Gun",value:1,code:"DD Gun"},2:{name:"Light Cruiser Gun",value:2,code:"CL Gun"},4:{name:"Heavy Cruiser Gun",value:4,code:"CA Gun"},8:{name:"Battleship Gun",value:8,code:"BB Gun"},16:{name:"Torpedoes",value:16,code:"Torp"},32:{name:"Sub Torpedoes",value:32,code:"Sub Torp"},64:{name:"Fighter",value:64,code:"Fighter"},128:{name:"Dive Bomber",value:128,code:"Dive Bomber"},256:{name:"Torp Bomber",value:256,code:"Torp Bomber"},512:{name:"Anti-air Gun",value:512,code:"AA Gun"},1024:{name:"Auxiliary",value:1024,code:"Aux"},2048:{name:"Anti-sub Equipment",value:2048,code:"ASW Eq"},4096:{name:"Special",value:4096,code:"Special"},8192:{name:"Deuts",value:8192,code:"Deuts"},16384:{name:"ASW Planes",value:16384,code:"ASWP"},3:{name:"DD/CL Gun",value:3,code:"DD/CL Gun"},448:{name:"Aircraft",value:448,code:"Aircraft"}}},EArmorType={LIGHT:1,MEDIUM:2,HEAVY:4,props:{1:{name:"Light Armor",value:1,code:"Light"},2:{name:"Medium Armor",value:2,code:"Medium"},4:{name:"Heavy Armor",value:4,code:"Heavy"}}},EAmmoType={NORMAL:1,NORMAL_PLUS:2,HE:4,HE_PLUS:8,AP:16,AP_PLUS:32,MAGNETIC:64,SANSHIKI_SHELL:128,SANSHIKI_FRAGS:256,props:{1:{name:"Normal",value:1,code:"Normal"},2:{name:"Normal+",value:2,code:"Normal+"},4:{name:"Explosive",value:4,code:"HE"},8:{name:"Explosive+",value:8,code:"HE+"},16:{name:"Armor Penetration",value:16,code:"AP"},32:{name:"Armor Penetration+",value:32,code:"AP+"},64:{name:"Magnetic",value:16,code:"MAG"},128:{name:"Sanshiki Shell",value:16,code:"SSShell"},256:{name:"Sanshiki Fragment",value:16,code:"SSFrag"}}};DGAttrToIdx={HP:0,FP:1,Torp:2,AA:3,AirPower:4,Rel:5,Armor:6,Acc:7,Eva:8,Speed:9,Luck:10,AntiSub:11};var EAttributes={DURABILITY:0,CANNON:1,TORP:2,AA:3,AIR:4,RELOAD:5,ARMOR:6,HIT:7,EVA:8,SPEED:9,LUCK:10,ANTISUB:11,props:{0:{name:"Durability",value:0,code:"HP"},1:{name:"Firepower",value:1,code:"FP"},2:{name:"Torp",value:2,code:"TORP"},3:{name:"Anti-Air",value:3,code:"AA"},4:{name:"Airpower",value:4,code:"AP"},5:{name:"Reload",value:5,code:"REL"},6:{name:"Armor",value:6,code:"ARMOR"},7:{name:"Hit",value:7,code:"HIT"},8:{name:"Evasion",value:8,code:"EVA"},9:{name:"Speed",value:9,code:"SPD"},10:{name:"Luck",value:10,code:"LUCK"},11:{name:"Antisub",value:11,code:"ASW"}}},DGearScore={1:{base:30,bonus:5},2:{base:50,bonus:8},3:{base:80,bonus:10},4:{base:120,bonus:12},5:{base:180,bonus:15},6:{base:300,bonus:20}},DArmorMods={1:{1:{1:1,2:.5,4:.2},2:{1:1,2:.6,4:.2},4:{1:1.2,2:.6,4:.6},10:{1:.9,2:.7,4:.4}},2:{1:{1:1,2:.75,4:.4},4:{1:1.4,2:.9,4:.7},8:{1:1.45,2:1.05,4:.7},16:{1:1,2:.8,4:.6},32:{1:1.1,2:.9,4:.7}},4:{1:{1:1,2:.9,4:.5},4:{1:1.35,2:.95,4:.7},16:{1:.75,2:1.1,4:.75}},8:{1:{1:.7,2:1,4:.9},4:{1:1.4,2:1.1,4:.9},16:{1:.3,2:1.3,4:1.1},128:{1:1.4,2:1.1,4:.9},256:{1:1.45,2:1.05,4:.7}},16:{1:{1:.8,2:1,4:1.3},64:{1:.8,2:1,4:1.3}},32:{1:{1:.8,2:1,4:1.3},64:{1:.8,2:1,4:1.3}},64:{},128:{},256:{1:{1:.8,2:1,4:1.3}}},DMapAvoidVal={1:{1:3,2:3,3:3,4:4},2:{1:4,2:4,3:5,4:5},3:{1:6,2:6,3:7,4:7},4:{1:8,2:8,3:9,4:9},5:{1:10,2:10,3:11,4:11},6:{1:12,2:12,3:13,4:13},7:{1:14,2:14,3:15,4:15},8:{1:16,2:17,3:17,4:18},9:{1:17,2:18,3:18,4:19},10:{1:18,2:19,3:19,4:20},11:{1:19,2:20,3:20,4:21},12:{1:20,2:21,3:21,4:22}},NUM_ATTRS=12,MAP_TYPE=[{name:"World",key:"W"}],CHAPTERS={W:["1","2","3","4","5","6","7","8","9","10","11","12","13"]},WORLD_SUB_CHAPTERS={1:["1","2","3","4","1-HM","2-HM","3-HM","4-HM"],2:["1","2","3","4","1-HM","2-HM","3-HM","4-HM"],3:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],4:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],5:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],6:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],7:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],8:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],9:["1","2","3","4","5","1-HM","2-HM","3-HM","4-HM"],10:["1","2","3","4","5"],11:["1","2","3","4"],12:["1","2","3","4"],13:["1","2","3","4"]},WORLD_DB_INDEX={1:["101","102","103","104","10101","10102","10103","10104"],2:["201","202","203","204","10201","10202","10203","10204"],3:["301","302","303","304","305","10301","10302","10303","10304"],4:["401","402","403","404","405","10401","10402","10403","10404"],5:["501","502","503","504","505","10501","10502","10503","10504"],6:["601","602","603","604","605","10601","10602","10603","10604"],7:["701","702","703","704","705","10701","10702","10703","10704"],8:["801","802","803","804","805","10801","10802","10803","10804"],9:["901","902","903","904","905","10901","10902","10903","10904"],10:["1001","1002","1003","1004","1005"],11:["1101","1102","1103","1104"],12:["1201","1202","1203","1204"],13:["1301","1302","1303","1304"]};function populateMapTypeDrop(){$("#dropMapType").children().remove().end();for(let a=0;a<MAP_TYPE.length;a++)$("#dropMapType").append("<option value='"+MAP_TYPE[a].key+"'>"+MAP_TYPE[a].name+"</option>");let a=$("#dropMapType").val();populateChapterDrop(a)}function populateChapterDrop(a){if($("#dropChapter").children().remove().end(),$("#dropSubChapter").children().remove().end(),!!(a in CHAPTERS)){let b=CHAPTERS[a];for(let a=0;a<b.length;a++)$("#dropChapter").append("<option value='"+b[a]+"'>"+b[a]+"</option>");let c=$("#dropChapter").val();populateSubChapterDrop(c)}}function populateSubChapterDrop(a){if($("#dropSubChapter").children().remove().end(),!!(a in WORLD_SUB_CHAPTERS)){let b=WORLD_SUB_CHAPTERS[a];for(let a=0;a<b.length;a++)$("#dropSubChapter").append("<option value='"+a+"'>"+b[a]+"</option>")}}function resetTable(a){var b=$("#dtBasicExample").DataTable(),c=b.page.len();b.destroy(),$("#dtBasicExample").empty();let d=[];for(let b=0;b<a.length;b++)d.push(a[b].getEntry());$("#dtBasicExample").DataTable({data:d,columns:[{title:"Icon"},{title:"<div style='width:100px;'>Name</div>"},{title:"Level"},{title:"<img src='img/attr/hp.png' style='width: 30px;' />"},{title:"<img src='img/attr/armor.png' style='width: 30px;' />"},{title:"<img src='img/attr/fp.png' style='width: 30px;' />"},{title:"<img src='img/attr/torp.png' style='width: 30px;' />"},{title:"<img src='img/attr/air.png' style='width: 30px;' />"},{title:"<img src='img/attr/aa.png' style='width: 30px;' />"},{title:"<img src='img/attr/eva.png' style='width: 30px;' />"},{title:"Hit"},{title:"Luck"},{title:"<div style='width:70px;'><span class='fa fa-question-circle clickable-icon' data-toggle='modal' data-target='#modalPrio' aria-hidden='true'></span> Priority</div>"},{title:"<div style='width:75px;'>Notes</div>"}],pageLength:c})}function init(){$("#dtBasicExample").DataTable(),$(".dataTables_length").addClass("bs-select");let a=loadJsonDBs();a.then(function(){populateMapTypeDrop(),$("#dropMapType").on("change",function(){let a=$("#dropMapType").val();populateChapterDrop(a)}),$("#dropChapter").on("change",function(){let a=$("#dropChapter").val();populateSubChapterDrop(a)}),$("#btnSearch").click(function(){let a=$("#dropChapter").val(),b=$("#dropSubChapter").val(),c=loadEnemies(WORLD_DB_INDEX[a][b]);resetTable(c)}),$(".material-tooltip-main").tooltip({template:"<div class=\"tooltip md-tooltip\"><div class=\"tooltip-arrow md-arrow\"></div><div class=\"tooltip-inner md-inner\"></div></div>"})})}var ENEMIES_PATH="../data/maps-enemies.json",ENEMIES_DATABASE={},CHAPTER_DATABASE={},EXPED_DATABASE={},DUNG_DATABASE={};function loadJsonDBs(){var a=$.getJSON(ENEMIES_PATH,function(a){ENEMIES_DATABASE=a.enemies,CHAPTER_DATABASE=a.chapters,EXPED_DATABASE=a.expeditions,DUNG_DATABASE=a.dungeons});return Promise.all([a])}function loadEnemies(a){if(!(a in CHAPTER_DATABASE))return;let b=CHAPTER_DATABASE[a],c=b.enemies,d=[];for(let b,f=0;f<c.length;f++)b=new Enemy(c[f].enemy,c[f].lvl),b.isBoss="isBoss"in c[f],b.isReinf=c[f].r,d.push(b);return d}function loadEnemy(a){if(!(a in ENEMIES_DATABASE))return console.log("No enemy with id "+a),null;let b=ENEMIES_DATABASE[a],c=null;if("base"in b){let a=b.base;c=ENEMIES_DATABASE[a]}return{base:c,enemy:b}}function loadIfExistsD(a,b,c){return b in a?a[b]:c}function calcStat(a,b,c,d){return 100<a?b+(a-1)*c/1e3+(a-100)*d/1e3:b+(a-1)*c/1e3}class Enemy{constructor(a,b){this.id=a,this.lvl=b,this.icon=null,this.name="",this.type=-1,this.nation=-1,this.armor=0,this.weight=0,this.stats=[],this.attrs=[],this.attrsGrowth=[];for(let c=0;c<NUM_ATTRS;c++)this.attrs[c]=0,this.attrsGrowth[c]=0,this.stats[c]=0;this.loadData(a),this.setLevel(b)}getLevel(){return this.lvl}getStat(a){return this.stats[a]}getCombatStat(a){return this.stats[a]}getArmor(){return this.armor}getType(){return this.type}getNation(){return this.nation}getFixedAmmo(){return null}loadStats(a){this.attrs=a.stats,this.attrsGrowth=a.growth,this.name=loadIfExistsD(a,"name",this.name),this.icon=loadIfExistsD(a,"icon",this.icon),this.nation=loadIfExistsD(a,"nation",this.nation),this.type=loadIfExistsD(a,"type",this.type),this.armor=loadIfExistsD(a,"armorType",this.armor),this.weight=loadIfExistsD(a,"weight",this.weight),this.isBoss="isBoss"in a,this.eqs=loadIfExistsD(a,"equips",[])}loadData(a){let b=loadEnemy(a);this.data=b;let c=b.base;c&&this.loadStats(c),this.loadStats(b.enemy)}calcStats(){for(let a=0;a<NUM_ATTRS;a++)this.stats[a]=Math.floor(calcStat(this.lvl,this.attrs[a],this.attrsGrowth[a],0))}setLevel(a){this.lvl=a,this.calcStats()}isEnemy(){return!0}getTagList(){return[]}isVanguard(){return!1}isMainFleet(){return!1}isFlagship(){return!1}isLeader(){return!1}getTemplId(){return this.id}isType(a){return 0!=(this.type&a)}airResist(){return(100*(1-150/(150+this.stats[EAttributes.AA]))).toFixed(2)}getEntry(){let a="";return this.isBoss?a+="Boss":this.isReinf?a+=(""==a?"":"\n")+"Reinforcement":a="-",["<div style='width:40px; height:40px;'><img src='img/enemy-icons/"+this.icon+".png' style='width:40px;' /></div>",this.name,this.lvl,this.stats[EAttributes.DURABILITY],EArmorType.props[this.armor].code,this.stats[EAttributes.CANNON],this.stats[EAttributes.TORP],this.stats[EAttributes.AIR],"<a href='#' class='material-tooltip-main' style='border-bottom: 1px dashed;' data-toggle='tooltip' title='"+this.airResist()+"% air resistance'>"+this.stats[EAttributes.AA]+"</a>",this.stats[EAttributes.EVA],this.stats[EAttributes.HIT],this.stats[EAttributes.LUCK],this.weight,a]}}