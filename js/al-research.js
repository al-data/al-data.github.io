function handleFileSelect(a){var b=a.target.files;if(!(1>b.length)){var c=b[0],d=new FileReader;d.onload=onFileLoaded,d.readAsText(c)}}function openfileDialog(){$("#fileLoader").click()}function downloadJson(){var a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(DATABASE,null,4)),b=document.getElementById("downloadAnchorElem");b.setAttribute("href",a),b.setAttribute("download","db.json"),b.click()}function onFileLoaded(a){DATABASE=JSON.parse(a.target.result),processDatabase()}const DROP_ENTRY=({rarity:a,icon:b,qty:c,idx:d})=>`
    <div class="input-group mb-2 mr-sm-2 setting-group" data-idx="${d}">
        <div class="input-group-prepend">
            <div class="input-group-text group-header">
                <div class="gear-slot ${a}" data-toggle="modal" data-target="#gearPicker">
                    <img src="imgs/${b}.png" />
                </div>
            </div>
        </div>
        <div class="input-group-text group-val">
            <input type="text" value="${c}" class="input-qty form-control" placeholder="0" aria-label="" aria-describedby="basic-addon1"></input>
        </div>
        <div class="newBuildBtnDiv"><button type="button" class="btn btn-primary" onclick="deleteResult(this);">Delete Result</button></div>
    </div>
`,ADD_TO_DATABASE_BTN=()=>`
    <div class="addToDbBtn"><button type="button" class="btn btn-primary" onclick="addToDatabase();">Add to Database</button></div>
`,NEW_RESULT_BTN=a=>`
    <div class="newBuildBtnDiv"><button type="button" class="btn btn-primary" onclick="${a}();">New Result</button></div>
`,DELETE_BTN=()=>`
    <div class="newBuildBtnDiv"><button type="button" class="btn btn-primary" onclick="deleteResult(this);">Delete Result</button></div>
`,ITEM_ENTRY=({name:a,id:b,rarity:c,gearIcon:d,numStars:e})=>`
    <div class="gear-entry ${c}" data-dismiss='modal' data-tmpid="${b}">
        <img title="${a}" alt="${a}" src="imgs/${d}.png" />
    </div>
`,emptyBuild=a=>a.every(a=>-1===a);var STATE={},DATABASE={},DB_STATS={},CONVERT_SHIP_RARITY={2:"rarity-gray",3:"rarity-blue",4:"rarity-purple",5:"rarity-gold",6:"rarity-rainbow"},CONVERT_GEAR_RARITY={1:"rarity-gray",2:"rarity-gray",3:"rarity-blue",4:"rarity-purple",5:"rarity-gold",6:"rarity-rainbow"};function processDatabase(){DB_STATS.numResults=Object.keys(DATABASE.results).length,$("#spanDbDesc").text("Results: "+DB_STATS.numResults),$(".research-selector").show(),populateResearchDropDown()}function populateResearchDropDown(){$("#dropResearch").children().remove().end();for(i in DATABASE.researches)$("#dropResearch").append("<option  value='"+DATABASE.researches[i].id+"'>"+DATABASE.researches[i].name+"</option>");let a=$("#dropResearch").val();STATE.selectedResearch=parseInt(a),STATE.currentRes={id:parseInt(a),common:[],bonus:[]},updateResearch(STATE.currentRes)}function deleteResult(a){let b=$(a).parent().parent().data("idx"),c=$(a).parent().parent().parent().hasClass("commonDiv");c?STATE.currentRes.common.splice(b,1):STATE.currentRes.bonus.splice(b,1),updateResearch(STATE.currentRes)}function changeItem(a,b){let c=$(a).parent().parent().parent().data("idx"),d=$(a).parent().parent().parent().parent().hasClass("commonDiv");d?STATE.currentRes.common[c].id=b:STATE.currentRes.bonus[c].id=b,updateResearch(STATE.currentRes)}function changeQty(a,b){let c=$(a).parent().parent().data("idx"),d=$(a).parent().parent().parent().hasClass("commonDiv");d?STATE.currentRes.common[c].qty=b:STATE.currentRes.bonus[c].qty=b,updateResearch(STATE.currentRes)}function resetCurrentResearch(){STATE.currentRes.common=[],STATE.currentRes.bonus=[]}function addToDatabase(){STATE.currentRes.id&&(DATABASE.results.push(JSON.parse(JSON.stringify(STATE.currentRes))),resetCurrentResearch(),updateResearch(STATE.currentRes))}function addEmptyCommonDrop(){let a=STATE.selectedResearch;STATE.currentRes.common.push({id:-1,qty:1}),updateResearch(STATE.currentRes)}function addEmptyBonusDrop(){let a=STATE.selectedResearch;STATE.currentRes.bonus.push({id:-1,qty:1}),updateResearch(STATE.currentRes)}function updateResearch(){$(".builds-editor").children().remove().end();let a=STATE.currentRes.common,b=STATE.currentRes.bonus;for(let b in $(".builds-editor").append("<h3>Common List</h3>"),$(".builds-editor").append("<div class='commonDiv'></div>"),a){let c=a[b],d="misc/btn-add",e="rarity-none";if(c.id in DATABASE.items){let a=DATABASE.items[c.id];d=a.icon,e=a.rarity}$(".commonDiv").append(DROP_ENTRY({id:c.id,rarity:CONVERT_GEAR_RARITY[e+1],icon:d,qty:c.qty,idx:b}))}for(let a in $(".commonDiv").append(NEW_RESULT_BTN("addEmptyCommonDrop")),$(".builds-editor").append("<h3>Bonus List</h3>"),$(".builds-editor").append("<div class='bonusDiv'></div>"),b){let c=b[a],d="misc/btn-add",e="rarity-none";if(c.id in DATABASE.items){let a=DATABASE.items[c.id];d=a.icon,e=a.rarity}$(".bonusDiv").append(DROP_ENTRY({id:c.id,rarity:CONVERT_GEAR_RARITY[e+1],icon:d,qty:c.qty,idx:a}))}$(".bonusDiv").append(NEW_RESULT_BTN("addEmptyBonusDrop")),$(".builds-editor").append(ADD_TO_DATABASE_BTN()),$(".input-qty").on("change",function(){let a=parseInt($(this).val());changeQty(this,a)}),$(".gear-slot").click(function(){STATE.selectedItem=this})}function updateGearSlot(){let a=STATE.chosenGear,b=$(STATE.selectedItem).data("slot"),c=$(STATE.selectedItem).parent().data("idx"),d=STATE.selectedShip;DATABASE.currentRes[c].slots[b]=a}function init(){$("#fileLoader").change(handleFileSelect),STATE.selectedResearch=-1,$("#dropResearch").on("change",function(){let a=parseInt($("#dropResearch").val());STATE.selectedResearch=a,STATE.currentRes.id=a,updateResearch(STATE.currentRes)}),$("#gearPicker").on("show.bs.modal",function(){if(DATABASE.researches){$("#dropList").children().remove().end();let a=[];for(let b in DATABASE.items){let c=DATABASE.items[b];1<c.rarity&&a.push(ITEM_ENTRY({name:c.name,id:c.id,gearIcon:c.icon,rarity:CONVERT_GEAR_RARITY[c.rarity+1]}))}a.push(ITEM_ENTRY({name:"Coins",id:999999,gearIcon:"props/coins",rarity:CONVERT_GEAR_RARITY[5]})),$("#dropList").append(a.join("")),$(".gear-entry").click(function(){STATE.chosenGear=$(this).data("tmpid"),STATE.chosenGear&&(changeItem(STATE.selectedItem,STATE.chosenGear),updateResearch(STATE.currentRes))})}})}