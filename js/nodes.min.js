var ENodeType={SMALL_RECON:1,MEDIUM_RECON:2,LARGE_RECON:3,SMALL_MAINFLEET:4,MEDIUM_MAINFLEET:5,LARGE_MAINFLEET:6,SMALL_CARRIER:7,MEDIUM_CARRIER:8,LARGE_CARRIER:9,SMALL_TRANSPORT:10,MEDIUM_TRANSPORT:11,LARGE_TRANSPORT:12,UNKNOWN2:13,UNKNOWN:97,SIREN:98,BOSS:99,props:{1:{name:"",diffIcon:"xiao"},2:{name:"",diffIcon:"zhong"},3:{name:"",diffIcon:"da"},4:{name:"",diffIcon:"xiao"},5:{name:"",diffIcon:"zhong"},6:{name:"",diffIcon:"da"},7:{name:"",diffIcon:"xiao"},8:{name:"",diffIcon:"zhong"},9:{name:"",diffIcon:"da"},10:{name:"",diffIcon:"xiao"},11:{name:"",diffIcon:"zhong"},12:{name:"",diffIcon:"da"},13:{name:"",diffIcon:""},97:{name:"",diffIcon:""},98:{name:"",diffIcon:""},99:{name:"",diffIcon:""}}},SIREN_ICONS=["aijiangBB","aijiangCL","aijiangDD","aijiangCV","mingyunnvshen","ougen_h","gaoxiong_h","xianghe","sairenboss","sairenhangmu","sairenhangmu_i","sairenqingxun","sairenqingxun_i","sairenquzhu","sairenquzhu_i","sairenzhanlie","sairenzhanlie_i","sairenzhongxun","sairenzhongxun_i","xili","shentong","niaohai","wudao","canglong","sairenquzhu_ii","sairenqingxun_ii","sairenzhongxun_ii","sairenzhanlie_ii","ganraozhe","sairenhangmu_ii","sairenqianting","sairenboss11","unknown3","aruituosha","xiefeierde","duosaitejun","shengwang","weiershiqinwang","xiefeierde_idol","kelifulan_idol","xipeier_idol","jiasikenie_idol","sipeibojue_5","chicheng_idol","Vtuber_aqua","vtuber_mio","vtuber_matsuri","vtuber_sora","vtuber_shion","vtuber_fubuki","shengdiyage","tiaoyu","weiqita","yalisangna","liekexingdun","guanghui","longqibing","teluntuo","lituoliao","xia","xiang","guinu","gaoxiong_alter","moye","yishi","sunying","aerjiliya","jialisuoniye","wokelan","jiasikenie"];function populateMapTypeDrop(){$("#dropMapType").children().remove().end();let a=WAVE_DB.catNames;for(let b=0;b<a.length;b++)$("#dropMapType").append("<option value='"+b+"'>"+a[b]+"</option>");let b=$("#dropMapType").val();populateChapterDrop(b)}function populateChapterDrop(a){let b=parseInt(a);$("#dropChapter").children().remove().end(),$("#dropSubChapter").children().remove().end();let c=WAVE_DB.cats;if(!(b>=c.length)){let a=c[b];for(let b=0;b<a.length;b++)$("#dropChapter").append("<option value='"+b+"'>"+a[b]+"</option>");let d=$("#dropChapter").val();populateSubChapterDrop(d)}}function populateSubChapterDrop(a){let b=parseInt(a);$("#dropSubChapter").children().remove().end();let c=$("#dropMapType").val();if(c>=WAVE_DB.cats.length)return;if(b>=WAVE_DB.cats[c].length)return;let d=WAVE_DB.cats[c][b],e=WAVE_DB.maps[d];for(let b=0;b<e[1].length;b++)$("#dropSubChapter").append("<option value='"+b+"'>"+e[1][b][0]+"</option>")}var WAVE_DB={};const Node=({expedId:a,level:b,bgIcon:c,diff:d,hasDiff:e,bossIcon:f,hasBossIcon:g,isSirenIcon:h})=>`
            <div class="node cloudy-gradient m-2 border rounded-lg shadow p-2 border-dark" style="width:125px; height:125px;">
                <a style="color:black;" href="/exped.html?id=${a}">
                    <div style="position:relative;">
                        <img style="width:100%;" src="img/nodes/${c}.png" />
                        ${e?`<div style="position:absolute; bottom:0; right:0; width:40px; height:auto; border:0px solid black;">
                            <img style="width:100%;" src="img/nodes/${d}.png" />
                         </div>`:``}
                        ${g?`<div style="position:absolute; right:0; margin:auto; height:auto; border:0px solid black; ${h?`top: 0; width: 50px;`:`bottom: 0; width:80px;`}">
                            <img style="width:100%;" src="img/nodes/${f}.png" />
                        </div>`:``}   
                        <div style="position:absolute; top:0; left:0px; width:auto; height:auto; border:1px solid #666666; padding:1px; padding-left:5px; padding-right:5px; border-radius:6px; background:#FFFFFF">
                            Lv.${b}
                        </div>
                    </div>
                </a>
            </div>
        `;function loadCurrent(){let a=$("#dropMapType").val(),b=$("#dropChapter").val(),c=$("#dropSubChapter").val(),d=WAVE_DB.cats;if(0>a||a>=d.length)return!1;let e=d[a];if(0>b||b>=e.length)return!1;let f=e[b];if(f){let a=WAVE_DB.maps[f][1];return!(0>c||c>=a.length)&&void loadWaves(WAVE_DB.maps[f][1][c][1])}}function validateLocalStorage(a,b,c){let d=WAVE_DB.cats;if(0>a||a>=d.length)return!1;let e=d[a];if(0>b||b>=e.length)return!1;let f=e[b];if(f){let a=WAVE_DB.maps[f][1];return!(0>c||c>=a.length)}}function saveToLocalStorage(){if(!localStorage)return;let a=$("#dropMapType").val(),b=$("#dropChapter").val(),c=$("#dropSubChapter").val();localStorage.setItem("mapType",a),localStorage.setItem("chapter",b),localStorage.setItem("subChapter",c)}function loadFromLocalStorage(){if(!localStorage)return;let a=localStorage.getItem("mapType"),b=localStorage.getItem("chapter"),c=localStorage.getItem("subChapter");null===a||null===b||null===c||(validateLocalStorage(a,b,c)?($("#dropMapType").val(localStorage.getItem("mapType")),populateChapterDrop($("#dropMapType").val()),$("#dropChapter").val(localStorage.getItem("chapter")),populateSubChapterDrop($("#dropChapter").val()),$("#dropSubChapter").val(localStorage.getItem("subChapter"))):console.log("Invalid local storage found. Resetting."))}function init(){let a=loadDb();a.then(function(){populateMapTypeDrop(),loadFromLocalStorage(),loadCurrent(),$("#dropMapType").on("change",function(){let a=$("#dropMapType").val();populateChapterDrop(a),saveToLocalStorage(),loadCurrent()}),$("#dropChapter").on("change",function(){let a=$("#dropChapter").val();populateSubChapterDrop(a),saveToLocalStorage(),loadCurrent()}),$("#dropSubChapter").on("change",function(){saveToLocalStorage(),loadCurrent()})})}function loadDb(){var a=$.getJSON("../data/endb.json",function(a){WAVE_DB=a});return Promise.all([a])}function loadWaves(a){if(!(a in WAVE_DB.chapters))return[];let b=WAVE_DB.chapters[a],c=b[5],d=b[6],e=[],f=[],g=[];for(let b,h=0;h<d.length;h++){b=WAVE_DB.expeds[d[h]],e.push(b);let a=ENodeType.props[b[1]],i={expedId:parseInt(d[h]),level:b[3],bgIcon:WAVE_DB.exIcons[b[4]],diff:a.diffIcon,hasDiff:""!=a.diffIcon,bossIcon:"enemy_boss",hasBossIcon:b[1]==ENodeType.BOSS,isSirenIcon:-1!=SIREN_ICONS.indexOf(WAVE_DB.exIcons[b[4]])};c.includes(d[h])?g.push(i):f.push(i)}$(".container").html(f.map(Node).join("")),$(".ambushes").html(g.map(Node).join("")),0<c.length?$(".ambushes-header").show():$(".ambushes-header").hide()}